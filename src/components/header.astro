---
import { getEnv } from '../lib/env'
import voidFile from '../assets/void.png'
import rss from '../assets/rss.svg'
import podcast from '../assets/podcast.svg'
import twitter from '../assets/twitter.svg'
import github from '../assets/github.svg'
import discord from '../assets/discord.svg'
import telegram from '../assets/telegram.svg'
import mastodon from '../assets/mastodon.svg'
import bluesky from '../assets/bluesky.svg'

const { SITE_URL, RSS_URL } = Astro.locals
const { channel } = Astro.props

const PODCASRT = getEnv(import.meta.env, Astro, 'PODCASRT')
const TWITTER = getEnv(import.meta.env, Astro, 'TWITTER')
const GITHUB = getEnv(import.meta.env, Astro, 'GITHUB')
const TELEGRAM = getEnv(import.meta.env, Astro, 'TELEGRAM')
const DISCORD = getEnv(import.meta.env, Astro, 'DISCORD')
const MASTODON = getEnv(import.meta.env, Astro, 'MASTODON')
const BLUESKY = getEnv(import.meta.env, Astro, 'BLUESKY')

const staticProxy = getEnv(import.meta.env, Astro, 'STATIC_PROXY') ?? '/static/'
const channelSlug = getEnv(import.meta.env, Astro, 'CHANNEL')
const channelSummaryRaw = channel?.description?.split('\n')?.[0]?.trim()
const channelSummary = channelSummaryRaw?.length ? channelSummaryRaw : channelSlug ? `@${channelSlug}` : ''
---

<div id="header" class="relative grid grid-cols-1 md:grid-cols-[1fr_auto] items-center md:items-end p-6 md:p-8 mb-6 rounded-3xl overflow-hidden" style="background: var(--header-gradient);">
  <div class="moments-header-info relative z-10 flex flex-col gap-4">
    <div class="header-title text-3xl font-bold text-[var(--foreground-color)] m-0">
      <a href={SITE_URL} class="site-title" title={channel?.title}>
        {channel?.title}
      </a>
    </div>
    <div class="header-icons flex items-center gap-2 flex-wrap">
      <a href={RSS_URL} target="_blank" rel="alternate" type="application/rss+xml" title="RSS Feed">
        <img {...rss} alt="RSS" class="social-icon w-6 h-6 p-1" />
      </a>

      {
        PODCASRT && (
          <a href={PODCASRT} target="_blank" title="Podcast">
            <img {...podcast} alt="Podcast" class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }

      {
        TWITTER && TWITTER.length > 0 && (
          <a href={`https://twitter.com/${TWITTER}`} title="Twitter" target="_blank">
            <img {...twitter} alt={`twitter.com/${TWITTER}`} class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }

      {
        GITHUB && GITHUB.length > 0 && (
          <a href={`https://github.com/${GITHUB}`} title="GitHub" target="_blank">
            <img {...github} alt={`github.com/${GITHUB}`} class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }

      {
        TELEGRAM && TELEGRAM.length > 0 && (
          <a href={`https://t.me/${TELEGRAM}`} title="Telegram" target="_blank">
            <img {...telegram} alt={`t.me/${TELEGRAM}`} class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }

      {
        DISCORD && DISCORD.length > 0 && (
          <a href={DISCORD} title="Discord" target="_blank">
            <img {...discord} alt="Discord Invite" class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }

      {
        MASTODON && MASTODON.length > 0 && (
          <a href={`https://${MASTODON}`} title="Mastodon" target="_blank">
            <img {...mastodon} alt={`@${MASTODON}`} class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }

      {
        BLUESKY && BLUESKY.length > 0 && (
          <a href={`https://bsky.app/profile/${BLUESKY}`} title="BlueSky" target="_blank">
            <img {...bluesky} alt={`@${BLUESKY}`} class="social-icon w-6 h-6 p-1" />
          </a>
        )
      }
    </div>
  </div>
  <div class="moments-header-avatar relative z-10 flex flex-col items-start md:items-center gap-3">
    <a href={SITE_URL} title={channel?.title} class="moments-header-avatar-link inline-flex">
      <img
        src={channel?.avatar?.startsWith('http') ? staticProxy + channel?.avatar : voidFile.src}
        alt={channel?.title}
        loading="eager"
        class="header-avatar w-20 md:w-24 h-20 md:h-24 rounded-xl md:rounded-2xl border-4 border-white shadow-lg block object-cover"
      />
    </a>
    <!-- <div class="moments-header-meta"> -->
    <!-- <span class="moments-header-name">{channel?.title}</span> -->
    <!-- {
        channelSummary && (
          <span class="moments-header-desc">
            {channelSummary}
          </span>
        )
      } -->
    <!-- </div> -->
  </div>
</div>

<style>
  #header::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 80% 20%, rgba(7, 193, 96, 0.15), transparent 55%);
    pointer-events: none;
  }
</style>
